---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { getCollection } from 'astro:content';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { tagToSlug } from '../lib/slug';

// Thumbnails with runtime-safe lazy imports (avoid missing-file crashes in dev)
const thumbs = import.meta.glob('../assets/thumbs/*.svg', { query: '?url', import: 'default' });
async function getThumb(id: string) {
  const key = `../assets/thumbs/${id}.svg`;
  const def = `../assets/thumbs/default.svg`;
  const loader = (thumbs as Record<string, () => Promise<string>>)[key] || (thumbs as Record<string, () => Promise<string>>)[def];
  return await loader();
}

const allPosts = await getCollection('blog');
const latestPosts = allPosts
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .slice(0, 8);
const latestWithThumbs = await Promise.all(latestPosts.map(async (p) => ({ ...p, thumb: await getThumb(p.id) })));

// Compute tag cloud data
const tagCounts = new Map<string, number>();
for (const p of allPosts) {
  const tags = Array.isArray(p.data.tags) ? p.data.tags : [];
  for (const t of tags) tagCounts.set(t, (tagCounts.get(t) ?? 0) + 1);
}
const tags = [...tagCounts.entries()].sort((a, b) => a[0].localeCompare(b[0], 'sk'));
const allTags = [...tagCounts.entries()].sort((a, b) => a[0].localeCompare(b[0], 'sk'));
const counts = tags.map(([, c]) => c);
const minCount = counts.length ? Math.min(...counts) : 0;
const maxCount = counts.length ? Math.max(...counts) : 0;
const scale = (c: number) => {
  if (minCount === maxCount) return 1.0;
  const t = (c - minCount) / (maxCount - minCount);
  return 0.9 + t * 0.6; // 0.9em .. 1.5em
};
---

<!doctype html>
<html lang="sk">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
			<style>
				/* Glass + grid */
				.hero { text-align: center; }
				.hero h1 { font-size: clamp(2rem, 4vw, 3rem); margin: 0 0 0.5rem 0; }
				.hero p.lead { font-size: clamp(1.1rem, 2vw, 1.35rem); margin: 0.5rem 0 0; }
				/* Prevent horizontal overflow on narrow screens */
				.stop-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(min(100%, 360px), 1fr)); gap: 1rem; margin-top: 1.5rem; }
				.stop-card { text-align: center; }
				.stop-card h3 { margin: 0 0 0.25rem 0; }
				.stop-card p { margin: 0.25rem 0; }
				.latest-posts { margin-top: 3rem; }
				.posts { display: grid; grid-template-columns: repeat(auto-fit, minmax(min(100%, 360px), 1fr)); gap: 1rem; list-style: none; padding: 0; margin: 0; }
				.posts li a { display: block; text-decoration: none; }
				.posts li img, .posts li svg { display: block; width: 100%; height: auto; margin-bottom: 14px; border-radius: 12px; }
				.posts li .title { margin: 0; color: rgb(var(--black)); }
				.posts li .date { margin: 0; color: rgb(var(--gray)); }
				/* On hover, only adjust date; keep title color unchanged */
				.posts li:hover .date { color: rgb(var(--accent)); }
				.posts li:hover img, .posts li:hover svg { box-shadow: var(--box-shadow); }
				.tag-cloud { margin-top: 3rem; padding-top: 1rem; border-top: 1px solid rgb(var(--gray-light)); }
				.tag-cloud .tags { list-style: none; padding: 0; margin: 0.5rem 0 0 0; display: flex; flex-wrap: wrap; gap: 22px; align-items: baseline; }
				.lead{font-size: 1.5em; font-weight:200;}
			</style>
	</head>
	<body>
		<Header />
		<main class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
			<section class="hero text-center">
				<h1 class="mx-auto text-3xl sm:text-4xl md:text-5xl font-semibold">SpomaÄ¾. Mysli. Overuj. <br/>KritickÃ© myslenie v beÅ¾nom Å¾ivote.</h1>
			</section>

			<section class="stop-grid relative left-1/2 -translate-x-1/2 w-[90vw]">
				<div class="stop-card fancybox ">
					<h3><span style="font-size: 2em;"">S</span><br/>Skontroluj zdroj</h3>
					<p>â€“ Kto to tvrdÃ­? Je to dÃ´veryhodnÃ½ zdroj? MÃ¡ meno, odbornÃº autoritu, minulosÅ¥ v klamstvÃ¡ch?</p>
				</div>
				<div class="stop-card fancybox">
					<h3><span style="font-size: 2em;"">T</span><br/>Triezvo premÃ½Å¡Ä¾aj</h3>
					<p>â€“ NehrÃ¡ to na tvoje emÃ³cie? Znie to prÃ­liÅ¡ dobre/zle na to, aby to bola pravda?</p>
				</div>
				<div class="stop-card fancybox">
					<h3><span style="font-size: 2em;"">O</span><br/>Over fakty</h3>
					<p>â€“ DajÃº sa tvrdenia potvrdiÅ¥ z viacerÃ½ch nezÃ¡vislÃ½ch zdrojov? Je k tomu dÃ´kaz, Å¡tÃºdia, reÃ¡lne ÄÃ­sla?</p>
				</div>
				<div class="stop-card fancybox">
					<h3><span style="font-size: 2em;"">P</span><br/>Pozor na vlastnÃº zaujatosÅ¥ (bias)</h3>
					<p>â€“ NehÄ¾adÃ¡Å¡ len to, Äo potvrdzuje tvoje nÃ¡zory? NeodmietaÅ¡ nieÄo len preto, Å¾e s tÃ½m nesÃºhlasÃ­Å¡?</p>
				</div>
				
			</section>

				<div
				class="bg-black p-8 md:px-10 md:py-10 mt-10 mb-12 mx-auto max-w-5xl rounded-lg flex flex-col items-center text-center">
				<h5 class="text-white text-4xl md:text-6xl tracking-tight">
					Kto myslÃ­, ten STOPne.
				</h5>
				</div>
			
			<section>
				
				<p>Na internete je dnes Å¥aÅ¾kÃ© vyznaÅ¥ sa. KaÅ¾dÃ½ mÃ¡ â€svoju pravduâ€œ, nieÄo zdieÄ¾a, nieÄo komentuje, nieÄomu verÃ­. A je Ãºplne normÃ¡lne, ak sa v tom Älovek obÄas stratÃ­. Aj my sme verili veciam, ktorÃ© neboli Ãºplne pravdivÃ© â€“ a moÅ¾no stÃ¡le niektorÃ½m verÃ­me.</p>
				<p>Preto vznikol tento web. <strong>Kriticky.sk</strong> je miesto pre kaÅ¾dÃ©ho, kto si kladie otÃ¡zky. Kto nechce hneÄ uveriÅ¥ vÅ¡etkÃ©mu, ale ani hneÄ vÅ¡etko odmietaÅ¥. Kto chce rozumieÅ¥ svetu okolo seba â€“ a nauÄiÅ¥ sa rozliÅ¡ovaÅ¥ fakty od domnienok, emÃ³cie od reality.</p>
			</section>
			<blockquote>
				<p>â€MÃºdry Älovek porovnÃ¡va svoje tvrdenia s dÃ´kazmi.â€œ</p>
				<footer>â€” <cite>David Hume</cite></footer>
			  </blockquote>

			<section class="fancybox p-6 mt-4">
				<h2>ÄŒo je to kritickÃ© myslenie?</h2>
				<p>KritickÃ© myslenie nie je o tom byÅ¥ "mÃºdrejÅ¡Ã­" neÅ¾ ostatnÃ­.<br/>Je to zruÄnosÅ¥, ktorÃº si mÃ´Å¾e rozvÃ­jaÅ¥ kaÅ¾dÃ½ â€“ Äi mÃ¡ 16 alebo 60.<br/>Ide len o to, <strong>spomaliÅ¥, pozrieÅ¥ sa na veci s odstupom a poloÅ¾iÅ¥ si zopÃ¡r otÃ¡zok</strong>.</p>
				<span class="bg-yellow-300">â†’ CTA button: â€œÄŒo je kritickÃ© myslenie?â€ â†’ leads to detailed explanation</span>Maybe filters by category (e.g. Politika, MÃ©diÃ¡, Hoaxy, VzÅ¥ahy)
			</section>

			<section class="fancybox p-6 mt-4">
				<h2>ğŸ›‘ MetÃ³da STOP</h2>
				<p>JednoduchÃ½ nÃ¡stroj, ktorÃ½ ti pomÃ´Å¾e, keÄ nieÄo znie aÅ¾ prÃ­liÅ¡ dobre (alebo zle) na to, aby to bola pravda:</p>
				<p><strong>S</strong> â€“ <strong>Skontroluj zdroj</strong><br/>
				<strong>T</strong> â€“ <strong>Triezvo premÃ½Å¡Ä¾aj</strong><br/>
				<strong>O</strong> â€“ <strong>Over fakty</strong><br/>
				<strong>P</strong> â€“ <strong>Pozor na vlastnÃº zaujatosÅ¥</strong></p>

				<p>TÃ½chto 4 krokov ti mÃ´Å¾e uÅ¡etriÅ¥ nielen trapas na Facebooku, ale aj nÃ¡zor, ktorÃ©ho by si mohol Äasom Ä¾utovaÅ¥.</p>
			</section>

			<section class="fancybox p-6 mt-4" >
				<h2>ÄŒo tu nÃ¡jdeÅ¡?</h2>
				<p>ğŸ§© <strong>PrÃ­klady z praxe</strong><br/>ReÃ¡lne prÃ­klady z mÃ©diÃ­, sociÃ¡lnych sietÃ­, politiky â€“ rozobranÃ© jednoducho, bez pouÄovania.</p>
				<p>ğŸ” <strong>NÃ¡vody a techniky</strong><br/>Ako si overiÅ¥ informÃ¡cie, ako spoznaÅ¥ zavÃ¡dzanie, ako si daÅ¥ pozor na vlastnÃ© chyby v uvaÅ¾ovanÃ­.</p>
				<p>ğŸ§  <strong>ZaujÃ­mavosti o Ä¾udskej mysli</strong><br/>PreÄo nÃ¡s lÃ¡kajÃº jednoduchÃ© rieÅ¡enia? PreÄo si niektorÃ© nÃ¡zory chrÃ¡nime ako keby boli naÅ¡e deti? (A Äo s tÃ½m?)</p>
			</section>

			<section class="fancybox p-6 mt-4" >
				<h2>Pre koho to je?</h2>
				<p>Pre vÅ¡etkÃ½ch, ktorÃ­ si niekedy povedali:<br/>
				<strong>â€Toto mi nesedÃ­â€¦ ale neviem preÄo.â€œ</strong><br/>
				alebo<br/>
				<strong>â€NieÄo mi tu nesedÃ­â€¦ ale ostatnÃ­ to zdieÄ¾ajÃº, tak asi OK?â€œ</strong></p>
				<p>Ak chceÅ¡ rozumieÅ¥ svetu, ale nechceÅ¡ byÅ¥ manipulovanÃ½ â€“ si tu sprÃ¡vne.<br/>
				Ak si myslÃ­Å¡, Å¾e nikto nemÃ¡ vÅ¾dy pravdu â€“ vitaj.<br/>
				Ak si zvedavÃ½, ale opatrnÃ½ â€“ poÄ Äalej.</p>
			</section>

			<section class="fancybox p-6 mt-4" >
				<h2>PreÄo to robÃ­me?</h2>
				<p>Lebo verÃ­me, Å¾e <strong>kritickÃ© myslenie patrÃ­ do kaÅ¾dodennÃ©ho Å¾ivota</strong>.<br/>
				Nie ako Å¡kolskÃ¡ pouÄka, ale ako uÅ¾itoÄnÃ½ kompas pre dobu, kde sa informÃ¡cie Å¡Ã­ria rÃ½chlejÅ¡ie neÅ¾ rozum.</p>
				<p>Nechceme ti hovoriÅ¥, Äo si mÃ¡Å¡ myslieÅ¥.<br/>
				Chceme ti pomÃ´cÅ¥ <strong>rozpoznaÅ¥, kedy sa oplatÃ­ myslieÅ¥ viac.</strong></p>
				<p>Vitaj.</p>
				<p>A hlavne â€“<br/>
					<strong>SpomaÄ¾. Mysli. Overuj.</strong></p>
			</section>


			<section class="latest-posts relative left-1/2 -translate-x-1/2 w-[90vw] mt-12">
				<h2>NajnovÅ¡ie ÄlÃ¡nky</h2>
				<span class="bg-yellow-300">â†’ Maybe filters by category (e.g. Politika, MÃ©diÃ¡, Hoaxy, VzÅ¥ahy)</span>
				<ul class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 list-none p-0 m-0">
					{
						latestWithThumbs.map((post) => (
							<li class="glass p-3 rounded-[14px]">
								<a class="block group no-underline" href={`${import.meta.env.BASE_URL}blog/${post.id}/`}>
									<img class="w-full h-auto rounded-[12px] mb-3" src={post.thumb} alt="" />
									<h4 class="title">{post.data.title}</h4>
									<p class="date group-hover:text-[var(--accent)]">
										<FormattedDate date={post.data.pubDate} />
									</p>
								</a>
							</li>
						))
					}
				</ul>
				<p class="view-all"><a href={`${import.meta.env.BASE_URL}blog/`}>ZobraziÅ¥ vÅ¡etky ÄlÃ¡nky â†’</a></p>
			</section>

			{tags.length > 0 && (


			<section class="tag-cloud mt-12 pt-4 border-t border-gray-200 relative left-1/2 -translate-x-1/2 w-[90vw] mt-12">
			  <h3>PodÄ¾a tÃ©m</h3>
			  <ul class="flex flex-wrap gap-2 sm:gap-3 md:gap-6 items-baseline p-0 m-0 list-none">
				{allTags.map(([t, c]) => (
				  <li>
					<a class="inline-block bg-gray-200 text-gray-800 rounded-full px-3 py-1 no-underline hover:bg-gray-300" href={`/tags/${tagToSlug(t)}/`}>{t} <span class="text-gray-500 ml-1 text-sm">({c})</span></a>
				  </li>
				))}
			  </ul>
			</section>
			)}

		</main>

			
		<Footer />
	</body>
</html>
