---
// Client-only Supabase comments (moderated):
// - Reads PUBLIC_SUPABASE_URL and PUBLIC_SUPABASE_ANON_KEY
// - Lists approved comments for the given slug
// - Submits new comments as pending (is_approved=false set via RLS)
// UI text is Slovak; code identifiers in English
interface Props { slug: string; }
const { slug } = Astro.props as Props;
import commentsClientUrl from '../assets/comments-client.js?url';
const canRun = Boolean(import.meta.env.PUBLIC_SUPABASE_URL && import.meta.env.PUBLIC_SUPABASE_ANON_KEY);
---

<section class="comments" aria-label="Koment√°re">
  <h3> üí¨ Diskusia</h3>
  <h5>Prida≈• koment√°r:</h5>

  {!canRun && (
    <p class="note">Koment√°re s√∫ doƒçasne vypnut√©. Ch√Ωba <code>PUBLIC_SUPABASE_URL</code> alebo <code>PUBLIC_SUPABASE_ANON_KEY</code>.</p>
  )}

  {canRun && (
    <>
      <form id="comment-form" method="POST" action="javascript:void(0)" onsubmit="return false" novalidate>
        <input type="hidden" name="slug" value={slug} />
        <p>
          <label>Meno
            <input name="name" required maxlength="80" />
          </label>
        </p>
        <p>
          <label>E‚Äëmail (nepovinn√©)
            <input type="email" name="email" />
          </label>
        </p>
        <p class="hp">
          <label>Nepou≈æ√≠vaj toto pole
            <input name="hp_field" tabindex="-1" autocomplete="off" />
          </label>
        </p>
        <p>
          <label>Koment√°r
            <textarea name="message" required minlength="3" maxlength="5000"></textarea>
          </label>
        </p>
        <button type="button">Odosla≈• koment√°r</button>
        <span id="form-status" role="status" aria-live="polite"></span>
      </form>
      <hr />
      <div id="comments-list" data-slug={slug} data-supabase-url={import.meta.env.PUBLIC_SUPABASE_URL} data-supabase-key={import.meta.env.PUBLIC_SUPABASE_ANON_KEY}>
        <div class="loading">Naƒç√≠tavam koment√°re‚Ä¶</div>
      </div>

      <script type="module" src={commentsClientUrl}></script>
      
    </>
  )}

  <style>
    .comments { margin-top: 2rem; background: #51716c; padding: 20px; color: white; border-radius: 18px;}
    .comments :is(h2, h3, h4, h5, h6){ margin-bottom: 0.5rem; color: white; }
    .loading, .muted { color: rgb(var(--gray)); }
    .error { color: #e11d48; }
    .comment { padding: 0.75rem 0; border-bottom: 1px solid rgba(0,0,0,0.08); }
    .comment .meta { color: black; font-size: 0.9rem; color: rgb(var(--gray)); margin-bottom: 0.25rem; }
    .comment .body { white-space: pre-wrap; }
    form#comment-form p { margin: 1rem 30px 0px 20px; width: 90%;}
    form#comment-form input, form#comment-form textarea { width: 100%; padding: 13px; border: none; border-radius: 12px; background: #f2f2f2; }
    form#comment-form textarea {height: 150px;}
    form#comment-form .hp { position: absolute; left: -9999px; opacity: 0; height: 0; }
    #form-status { margin-left: 0.75rem; color: rgb(var(--white));}
    form#comment-form button{padding: 10px 15px; color: white; background:black; border: 0px; border-radius: 6px; font-size: 1em; cursor: pointer;}
    
  </style>
</section>
